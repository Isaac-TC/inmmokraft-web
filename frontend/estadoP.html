<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Estado de Propiedades</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="img/logo.png">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/stylesFormulario.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    html, body {
      height: 100%;
    }
  </style>
</head>
<body class="bg-gray-100 h-full">
  <div class="flex group">

    <!-- BARRA LATERAL -->
    <aside class="fixed top-0 left-0 h-screen bg-white shadow-md w-16 group-hover:w-64 transition-all duration-300 z-10 overflow-hidden">
      <div class="p-4">
        <nav class="mt-6">
          <ul class="space-y-4">
            <li><a href="home.html" class="flex items-center space-x-3 text-gray-700 hover:text-blue-700"><i class="fas fa-building"></i><span class="opacity-0 group-hover:opacity-100 transition-opacity duration-300">Home</span></a></li>
            <li><a href="registroP.html" class="flex items-center space-x-3 text-gray-700 hover:text-blue-700"><i class="fas fa-sign-in-alt"></i><span class="opacity-0 group-hover:opacity-100 transition-opacity duration-300">Registro</span></a></li>
            <li><a href="estadoP.html" class="flex items-center space-x-3 text-gray-700 hover:text-blue-700"><i class="fas fa-home"></i><span class="opacity-0 group-hover:opacity-100 transition-opacity duration-300">Estado</span></a></li>
            <li><a href="documentos.html" class="flex items-center space-x-3 text-gray-700 hover:text-blue-700"><i class="fas fa-file-alt"></i><span class="opacity-0 group-hover:opacity-100 transition-opacity duration-300">Documentos</span></a></li>
          </ul>
        </nav>
      </div>
    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="ml-16 group-hover:ml-64 transition-all duration-300 w-full min-h-screen overflow-y-auto">
      <!-- BARRA SUPERIOR -->
      <section style="background-color: #156091;" class="text-white px-6 py-4 flex flex-col sm:flex-row items-center sm:items-start gap-4">
        <img src="img/logo.png" alt="Logo Inmmokraft" class="w-20 h-20 rounded-full border-4 border-white shadow-md object-cover" />
        <div><h2 class="text-2xl font-bold">Consorcio Inmmokraft<br class="sm:hidden"> Cia. Ltda.</h2></div>
      </section>

      <div class="p-6">
        <h1 class="text-3xl font-bold mb-4">Propiedades Registradas</h1>

        <table class="min-w-full bg-white border border-gray-300 rounded-md shadow-md">
          <thead class="bg-gray-200">
            <tr>
              <th class="py-2 px-4 border">Código</th>
              <th class="py-2 px-4 border">Operación</th>
              <th class="py-2 px-4 border">Dirección</th>
              <th class="py-2 px-4 border">Vendedor</th>
              <th class="py-2 px-4 border">Comprador</th>
              <th class="py-2 px-4 border">Agente</th>
              <th class="py-2 px-4 border">Estado</th>
              <th class="py-2 px-4 border">Acciones</th>
            </tr>
          </thead>
          <tbody id="tabla-propiedades" class="text-sm">
            <!-- Datos desde JS -->
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <script>
    fetch("http://localhost:3000/api/propiedades")
      .then(res => res.json())
      .then(data => {
        const tabla = document.getElementById("tabla-propiedades");
        data.forEach(prop => {
          const fila = document.createElement("tr");
          fila.innerHTML = `
            <td class="border px-2 py-1">${prop.codigo}</td>
            <td class="border px-2 py-1">${prop.tipo_operacion}</td>
            <td class="border px-2 py-1">${prop.direccion}</td>
            <td class="border px-2 py-1">${prop.vendedor}</td>
            <td class="border px-2 py-1">${prop.comprador}</td>
            <td class="border px-2 py-1">${prop.agente}</td>
            <td class="border px-2 py-1">${prop.estado}</td>
            <td class="border px-2 py-1 space-x-2">
              <button onclick="editarPropiedad('${prop.codigo}')" class="bg-yellow-400 hover:bg-yellow-500 text-white px-2 py-1 rounded">Editar</button>
              <button onclick="eliminarPropiedad('${prop.codigo}')" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded">Eliminar</button>
            </td>
          `;
          tabla.appendChild(fila);
        });
      });

    function eliminarPropiedad(codigo) {
      if (!confirm("¿Estás seguro de eliminar esta propiedad?")) return;
      fetch(`http://localhost:3000/api/propiedades/${codigo}`, {
        method: "DELETE"
      })
        .then(res => res.text())
        .then(msg => {
          alert(msg);
          location.reload();
        })
        .catch(err => alert("Error al eliminar"));
    }
  </script>
</body>
</html>
